---
title: "Salary"
author: "Yang Yuetong"
date: "2025-09-15"
output: pdf_document
---
## READ ME
This piece of analysis was collaborated with other group members as part of a school assignment.

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(magrittr)
library(tinytex)
library(readxl)
library(resampledata)
library(glue)
library(kableExtra)
```

```{r}
hr <- read.csv("hr2.csv", stringsAsFactors = TRUE)
```

## Which department records the lowest average salary, and what is the most common reason for leaving the current position?

Productions department has the lowest average salary at \$59 953.55, and the most common reason for leaving the position is having found another position.

```{r, message=FALSE, warning=FALSE}
Q3Salary <- hr %>% group_by(department) %>% summarize("Average Salary" = mean(salary))

#Group by department and Termination, with the counts of the respective reason
dpt_TR_group <- hr %>% group_by(department,terminationreason) %>% summarize(Count = n())

#Exclude employees still employed
exclude_employed <- dpt_TR_group %>% filter(terminationreason!= "N/A-StillEmployed")

#Extract top termination reason
Q3MaxCount <- exclude_employed %>% group_by(department) %>% filter(Count==max(Count))

#Combine with Mean salary
Q3Table <- inner_join(Q3Salary,Q3MaxCount,by="department")
colnames(Q3Table) <- c("Department","Average Salary", "Top Termination Reason", "Count")
kbl(Q3Table, booktabs = T) %>% 
  kable_styling(latex_options = c("striped", "scale_down","hold_position"))
```



We hypothesise that employees who are paid lower are more likely to voluntarily terminate their job.

## Employment Status and Salary

Firstly, active employees earn on average **\$70,694**, while voluntarily terminated employees earn significantly less at an average of **\$63,949.**

Additionally, it seems that those who terminate voluntarily have slightly higher number of absences on average compared to active employees.
This may suggest disengagement before resigning, and hence absenteeism can be a potential indicator of an employee’s likelihood to terminate.

```{r, message=FALSE, warning=FALSE, Q4status, fig.width=5.5, fig.height=3}
Q4status <- hr %>% group_by(employmentstatus) %>% summarize("Count" = n(),
                                                            "Average Salary" = mean(salary),
                                                            "Average Absences" = mean(absences))
kbl(Q4status, booktabs = T) %>% 
  kable_styling(latex_options = c("striped", "scale_down","hold_position"))

ggplot(Q4status, aes(x = employmentstatus, y = `Average Salary`, fill = employmentstatus)) +
  geom_bar(stat = "identity", width = 0.6,color = "black", linewidth = 0.5) +
  scale_fill_manual(values = c("lightgreen", "lightblue","lightcoral")) +
  labs(title = "Average Salary by Employment Status",
       x = "Employment Status", y = "Average Salary") +
  theme_minimal() +
  theme(legend.position = "none")

```

### Permutation Testing

To test if lower salary is indeed related to increased voluntary termination, permutation testing can be conducted.

**H0 (null hypothesis):** Salary is unrelated to voluntary termination

**H1 (alternative hypothesis):** Employees with lower salaries are more likely to voluntarily terminate their employment.

```{r, message=FALSE, warning=FALSE}
set.seed(123)
status <- hr$employmentstatus
salary <- hr$salary
meanquit <- hr[hr$employmentstatus =="Voluntarily Terminated","salary"] %>% mean()
meanactive <- hr[hr$employmentstatus =="Active","salary"] %>% mean()
obs <- meanactive - meanquit


#Permutation
N <- 10^4
result <- numeric(N)
for (i in 1:N){
  #Take a permutation sample w/o replacement
  shufflestatus <- sample(status,size=length(status),replace=FALSE)
  #For each permutation, calculate test statistic
  result[i] <- mean(salary[shufflestatus=="Active"])-
    mean(salary[shufflestatus=="Voluntarily Terminated"])
}
#One sided test
pvalue <- (sum(result>=obs) + 1) / (N+1) 
glue('p-value is {round(pvalue,4)}.')

```

Since p-value = 0.0117 \< 0.05, we can reject Null Hypothesis and lower salary is likely associated with higher voluntary termination.

## Termination Reason and Salary

To further investigate reasons for termination, we create a table to visualise what are frequent reasons cited for those who voluntarily terminate their job.

As seen below, "more money" constitutes the 3rd most frequently cited reason for voluntary termination.
Correspondingly, those who cite "more money" as a termination reason also has **lower** **salary** at an average of \$57 148.
It should be noted that other reasons including finding another position, or unhappiness also constitute the top 2 reasons for voluntary termination.

```{r, message=FALSE, warning=FALSE}
Q4reason <- hr %>% filter(employmentstatus == "Voluntarily Terminated") %>%
                    group_by(terminationreason) %>% 
                    summarize("Average Salary" = mean(salary),"Count" = n())

kbl(arrange(Q4reason,desc(Count)), booktabs = T) %>% 
  kable_styling(latex_options = c("striped", "scale_down","hold_position"))
```

## Voluntary Termination Across Departments

Categorised by departments, **productions** department has the **lowest average salary** (\$59,954) and the **highest termination rate** (35.9%).

```{r, message=FALSE, warning=FALSE}
Q4department <- hr %>% group_by(department) %>% 
                summarize("Proportion terminated (%)" = 
                            round(sum(employmentstatus=="Voluntarily Terminated")*100/n(),4),
                          "Average Salary" = mean(salary))
kbl(Q4department, booktabs = T) %>% 
  kable_styling(latex_options = c("striped", "scale_down","hold_position"))
```

Based on the plot below, among those who voluntarily terminated their employment, those in **production** have the **lowest salary ranges,** tightly clustered between \$50k–70k, corroborating with the above findings.
More terminations are observed in the productions department compared to others, suggesting that these employees may feel underpaid compared to those in other departments, causing them to leave.

```{r, message=FALSE, warning=FALSE}
all_terminated <- hr %>% filter(employmentstatus == "Voluntarily Terminated") %>%  
  select("department","salary","performancescore","jobsatisfactionscore","terminationreason")


ggplot(all_terminated, aes(x = department, y = salary, fill = department)) +
  geom_violin(alpha = 0.7) +
  geom_jitter(width = 0.2, alpha = 0.5, color = "black") +
  labs(title = "Salary Distribution of Voluntarily Terminated Across Departments",
       x = "Department", y = "Salary") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

```

```{r}
ggplot(hr, aes(x = department, fill = employmentstatus)) +
  geom_bar(position = "dodge") +
  labs(title = "Employment Status by Department",
       x = "Department", y = "Count") +
  scale_fill_manual(
    values = c(
      "Active" = "steelblue",
      "Voluntarily Terminated" = "orange",
      "Terminated for Cause" = "coral"
    )
    ) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```
Production has the highest termination rate, mostly voluntarily.

## Job satisfaction and Performance scores
Are these terminated employees performing worse or are less satisfied (if reflected in the scores)?

```{r}
ggplot(data = all_terminated, mapping = aes(x = salary, y = performancescore)) +
geom_point(aes(color = department))
```

Most terminated employees have a performance score of 3. We cannot conclude that they perform worse.

```{r}
ggplot(data = all_terminated, mapping = aes(x = salary, y = jobsatisfactionscore)) +
geom_point(aes(color = department))
```
Job satisfaction score seems quite varied for production employees.


## Voluntary Termination Across Roles

Building on the previous results, we segment employees into Director, Manager, Senior, and Regular Empoyee groups and compare the average pay of voluntary leavers and active employees within each peer group, thereby isolating seniority from department mix.

```{r}
#voluntarily terminated employees across roles
df_tag <- hr %>% filter(employmentstatus == "Voluntarily Terminated")

directors <- df_tag %>% filter(str_detect(position, regex("Director", ignore_case = T)) &
                                 !str_detect(position, regex("Manager|Sr|Senior", T)))

managers <- df_tag %>% filter(str_detect(position, regex("Manager", ignore_case = T)) &
                                !str_detect(position, regex("Director|Sr|Senior", T))) 

seniors <- df_tag %>% filter(str_detect(position, regex("Sr|Senior", ignore_case = T)) &
                               !str_detect(position, regex("Director|Manager", T)))

indv <- df_tag %>% filter(!str_detect(position,
                                      regex("Director|Manager|Sr|Senior", ignore_case = T)))
volTerm <- bind_rows(
  directors %>% mutate(role_group = "Director"),
  managers %>% mutate(role_group = "Manager"),
  seniors %>% mutate(role_group = "Senior"),
  indv %>% mutate(role_group = "Regular Employee")
) %>%
  group_by(role_group) %>%
  summarise(
    no_vol_leavers = n(), # count (sum of people) in each cat
    mean_salary_volLeavers = mean(salary, na.rm = TRUE), # mean salary per cat
    .groups = "drop"
  ) %>%
  arrange(factor(role_group, levels = c("Director","Manager","Senior","Regular Employee")))
```

```{r}
#active employees across roles
df_tag <- hr %>% filter(employmentstatus == "Active")

directorsS <- df_tag %>% filter(str_detect(position, regex("Director", ignore_case = T)) &
                                  !str_detect(position, regex("Manager|Sr|Senior", T)))

managersS <- df_tag %>% filter(str_detect(position, regex("Manager", ignore_case = T)) &
                                 !str_detect(position, regex("Director|Sr|Senior", T)))

seniorsS <- df_tag %>% filter(str_detect(position, regex("Sr|Senior", ignore_case = T)) &
                                !str_detect(position, regex("Director|Manager", T)))

indvS <- df_tag %>% filter(!str_detect(position,
                                       regex("Director|Manager|Sr|Senior", ignore_case = T)))

Active <- bind_rows(
  directorsS %>% mutate(role_group = "Director"),
  managersS %>% mutate(role_group = "Manager"),
  seniorsS %>% mutate(role_group = "Senior"),
  indvS %>% mutate(role_group = "Regular Employee")
) %>%
  group_by(role_group) %>%
  summarise(
    no_stayers = n(), # count (sum of people) in each cat
    mean_salary_stayers = mean(salary, na.rm = TRUE), # mean salary per cat
    .groups = "drop"
  ) %>%
  arrange(factor(role_group, levels = c("Director","Manager","Senior","Regular Employee")))

```

```{r}
comparison <- full_join(volTerm, Active, by = "role_group", c("Voluntarily Terminated, Active"))
Q4roles <- comparison %>% 
  mutate(perLeave = round(no_vol_leavers*100/(no_vol_leavers + no_stayers),3), 
         #Calculate % of people who leave
          perPayDiff = if_else(!is.na(mean_salary_volLeavers) & !is.na(mean_salary_stayers),
          #Calculate % difference in pay
          round((mean_salary_volLeavers - mean_salary_stayers)*100 / mean_salary_stayers,3), NA_real_)) 
colnames(Q4roles) <- c("Role Type","No. of Voluntarily Terminated", "Mean Salary (Voluntarily Terminated)",
                          "No. of Active", "Mean Salary (Active)", "Proportion Terminated (%)",
                          "Pay Difference (Voluntarily Terminated - Active) (%)")
kbl(Q4roles, booktabs = T,align='c') %>% 
  kable_styling(latex_options = c("striped", "scale_down","hold_position"))
```

From this, we can see that contrary to our inital findings, a lower salary does not necessarily mean that the employee is more likely to terminate their contract.

For **higher roles like Managers and Seniors**, departures are not explained by lower pay.
In these groups, leavers are on average better paid than stayers (\~12-14% higher), suggesting pull factors (external offers, role fit, scope) rather than compensation.

For **regular employees**, departures can be explained by lower pay.
Leavers on average have a lower salary than their counterparts who stay (\~6% lower).

However, we do have to interpret with caution for small samples.
Senior has only one leaver and Director has none, limiting statistical confidence for those groups.

## Conclusion

In conclusion, our analysis supports the hypothesis that **lower salary is associated with higher voluntary termination, more often for regular employees**.

1.  Employees with lower salary are significantly more likely to leave (p-value = 0.0117), with many citing compensation ("more money") or dissatisfaction ("unhappy") as reasons to leave. On the other hand, those leaving for career change or health-related reasons earned more, suggesting these exits are less preventable.
2.  Looking into departments, the **productions** department with the lowest mean salary has the highest rates of resignation.
3.  When considering role types, regular employees who voluntarily terminate their employment have lower salary than those who stay (\~6% lower). However, higher ranking roles (Manager, Seniors) who voluntarily terminate their employment typically have higher salary than active ones, suggesting other pull factors asides from low pay among this group.

## Proposed Strategy

To retain employees, HR can ensure pay is competitive for roles with higher resignation rates, with greater attention to the **Productions** department.

The company can **offer higher salaries or bonuses** for individuals with lower salaries, especially regular employees, to reduce likelihood of voluntary termination.

HR can also **track employees with increased absenteeism** as this may serve as an indicator of likelihood of resignation, with those who resign having slightly higher absentee rates than active employees.

Finally, for higher ranking roles like managers or seniors, HR can explore career growth opportunities, including trainings or internal mobility offers so that employees do not feel that they must leave to progress.
